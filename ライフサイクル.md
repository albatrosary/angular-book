ルーティングには [Routing Guards](https://angular.io/docs/ts/latest/guide/router.html) という機能があり、ページ遷移するときのイベント処理やセキュリティとして問題がある場合に遷移禁止等処理が行えるようになっています。具体的には5つの Guards があります。

| Guards | 内容 |
| :--- | :--- |
| CanActivate | ルートへのナビゲーション評価 |
| CanActivateChild | 小ルートへのナビゲーション評価 |
| CanDeactivate | 現在のルートからナビゲーションを評価 |
| Resolve | アクティブ化する前のプリフェッチ評価 |
| CanLoad | 非同期ルートの評価 |

ルーティングに指定されているコンポーネント

* home.component
* pages.component
* top.component
* issue.component
* wiki.component

についてそれぞれ Guards を定義します。
```
$ ng g service home/guards-home
$ ng g service pages/guards-pages
$ ng g service pages/top/guards-top
$ ng g service pages/issue/guards-issue
$ ng g service pages/wiki/guards-wiki
```

### home.component に Routing Guards を定義

guards-home.service.ts は次のように定義しています。

```
import { Injectable } from '@angular/core';
import {
  CanActivate,
  CanActivateChild,
  CanDeactivate,
  Resolve,
  CanLoad
} from '@angular/router';

import { HomeComponent } from './home.component';

@Injectable()
export class GuardsHomeService implements CanActivate, CanActivateChild, CanDeactivate<HomeComponent>, Resolve<HomeComponent>, CanLoad {
  
  constructor() { }

  canActivate(): boolean {
    console.log('GuardsHomeService.canActivate()');
    return true;
  }
  
  canActivateChild(): boolean {
    console.log('GuardsHomeService.canActivateChild()');
    return true;
  }

  canDeactivate(): boolean {
    console.log('GuardsHomeService.canDeactivate()');
    return true;
  }

  resolve(): boolean {
    console.log('GuardsHomeService.resolve()');
    return true;
  }
  
  canLoad(): boolean {
    console.log('GuardsHomeService.canLoad()');
    return true;
  }
}

```

今回は処理をするというよりも、いつ実行されるかを評価しますのでコンソールにログを出力することのみ記載しています。これを app.routes.ts に設定します。

```
import { ModuleWithProviders } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { HomeComponent } from './home/home.component';
import { PageNotFoundComponent } from './page-not-found/page-not-found.component';

import { GuardsHomeService } from './home/guards-home.service';

const appRoutes: Routes = [
  { path: '', redirectTo: 'home', pathMatch: 'full'},
  {
    path: 'home',
    component: HomeComponent,
    canActivate: [GuardsHomeService],
    canActivateChild: [GuardsHomeService],
    canDeactivate: [GuardsHomeService],
    resolve: [GuardsHomeService],
    canLoad: [GuardsHomeService],
  },
  { path: '**', component: PageNotFoundComponent }
];

export const appRoutingProviders: any[] = [];

export const routing: ModuleWithProviders = RouterModule.forRoot(appRoutes);
```

次に app.module.ts にプロバイダ登録します。

```
import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';
import { FormsModule } from '@angular/forms';
import { HttpModule } from '@angular/http';

import { PagesModule} from './pages/pages.module'

import { AppComponent } from './app.component';
import { HomeComponent } from './home/home.component';
import { PageNotFoundComponent } from './page-not-found/page-not-found.component';
import { FooterComponent } from './footer/footer.component';

import { routing, appRoutingProviders } from './app.routes';

import { GuardsHomeService } from './home/guards-home.service';

@NgModule({
  declarations: [
    AppComponent,
    HomeComponent,
    PageNotFoundComponent,
    FooterComponent
  ],
  imports: [
    BrowserModule,
    FormsModule,
    HttpModule,
    PagesModule,
    routing
  ],
  providers: [
    appRoutingProviders,
    GuardsHomeService
  ],
  bootstrap: [AppComponent]
})
export class AppModule { }
```

### PagesにGaurdsを定義

guards-pages.service.ts は次のように定義しています。

```
import { Injectable } from '@angular/core';;
import {
  CanActivate,
  CanActivateChild,
  CanDeactivate,
  Resolve,
  CanLoad
} from '@angular/router';

import { PagesComponent } from './pages.component';

@Injectable()
export class GuardsPagesService implements CanActivate, CanActivateChild, CanDeactivate<PagesComponent>, Resolve<PagesComponent>, CanLoad {
  
  constructor() { }

  canActivate(): boolean {
    console.log('GuardsPagesService.canActivate()');
    return true;
  }
  
  canActivateChild(): boolean {
    console.log('GuardsPagesService.canActivateChild()');
    return true;
  }

  canDeactivate(): boolean {
    console.log('GuardsPagesService.canDeactivate()');
    return true;
  }

  resolve(): boolean {
    console.log('GuardsPagesService.resolve()');
    return true;
  }
  
  canLoad(): boolean {
    console.log('GuardsPagesService.canLoad()');
    return true;
  }
}

```

guards-top.service.ts は次のように定義しています。

```
import { Injectable } from '@angular/core';;
import {
  CanActivate,
  CanActivateChild,
  CanDeactivate,
  Resolve,
  CanLoad
} from '@angular/router';

import { TopComponent } from './top.component';

@Injectable()
export class GuardsTopService implements CanActivate, CanActivateChild, CanDeactivate<TopComponent>, Resolve<TopComponent>, CanLoad {
  
  constructor() { }

  canActivate(): boolean {
    console.log('GuardsTopService.canActivate()');
    return true;
  }
  
  canActivateChild(): boolean {
    console.log('GuardsTopService.canActivateChild()');
    return true;
  }

  canDeactivate(): boolean {
    console.log('GuardsTopService.canDeactivate()');
    return true;
  }

  resolve(): boolean {
    console.log('GuardsTopService.resolve()');
    return true;
  }
  
  canLoad(): boolean {
    console.log('GuardsTopService.canLoad()');
    return true;
  }
}

```

guards-pages.service.ts は次のように定義しています。



