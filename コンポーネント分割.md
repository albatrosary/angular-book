コンポーネント分割することで様々なメリットが現れます。テストが行いやすいというのもそのひとつです。

```
$ ng g component pages/issue/issue-detail
$ ng g component pages/issue/issue-input
$ ng g component pages/issue/issue-list
$ ng g component pages/issue/issue-update
```

### issue.component

はじめに`issue.component`を修正します。issue.componentはIssueの入力コンポーネントと入力された一覧を表示する部分を表示させるために定義します。

`issue.component.html` は次のようになります。

```
<h2>Issue</h2>
<app-issue-input></app-issue-input>
<app-issue-list></app-issue-list>
```

`issue.component.ts` は特別に処理というものが無いので次のような何も無くなります。

```
import { Component, OnInit } from '@angular/core';
import { NgForm } from '@angular/forms';

@Component({
  selector: 'app-issue',
  templateUrl: './issue.component.html',
  styleUrls: ['./issue.component.css']
})
export class IssueComponent implements OnInit {

  constructor (
  ) {}

  ngOnInit() {
  }
}
```

### issue-detail.component

`issue-detail.component.html`は一覧の詳細部分のみを記載します。

```
<div ngClass="row">{{rownum+1}}</div>
<p>{{title}}</p>
<pre>{{desc}}</pre>
<button (click)="onClick($event)">削除</button>
<button (click)="gotoUpdate()">更新</button>
```

`issue-detail.component.ts`では、@Inputによりissue-list.componentからデータを取得し、@OutputとEmitterを利用しイベントをissue-list.componentへ渡しています。

```
import { Component, OnInit, Input, Output, EventEmitter } from'@angular/core';
import { Router } from '@angular/router';

@Component({
  selector: 'app-issue-detail',
  templateUrl: './issue-detail.component.html',
  styleUrls: ['./issue-detail.component.css']
})
export class IssueDetailComponent implements OnInit {

  @Input('rownum')
  rownum: number;

  @Input('title')
  title: string;

  @Input('desc')
  desc: string;

  @Output()
  private onDelete = newEventEmitter();
  public onClick($event: any): void {
    this.onDelete.emit($event);
  }

  public gotoUpdate(): void {
    this.router.navigate(['/pages/issue/update', this.rownum]);
  }

  constructor(
    private router: Router
  ) { }

  ngOnInit() {
  }

}
```

### issue-input.component

issue-input.component.htmlでは入力部のみを定義しています。

```
<form #f="ngForm" (ngSubmit)="onSubmit(f)"novalidate>
  <input name="title" ngModel required placeholder="title">
  <textarea name="desc" ngModel required placeholder="desc"></textarea>
  <button type=submit [disabled]="!f.form.valid">登録</button>
</form>
```

issue-input.component.ts では入力された値をIssueServiceへ登録する部分のみ定義しています。

```
import { Component, OnInit } from'@angular/core';
import { NgForm } from'@angular/forms';

import { IssueService } from'../issue.service'

@Component({
  selector: 'app-issue-input',
  templateUrl: './issue-input.component.html',
  styleUrls: ['./issue-input.component.css']
})
export class IssueInputComponent implements OnInit {

  constructor(
    private issueService: IssueService
  ) {
  }

  ngOnInit() {
  }

  public onSubmit(form:NgForm):void {

    const issue = {
      title: form.value.title,
      desc: form.value.desc
    }

    this.issueService.add(issue);

    form.reset();
  }

}
```

### issue-list.component

issue-list.component.htmlではIssue登録された情報を一覧化し詳細についてはIssueDetailへ渡しています。

```
<div *ngFor="let issue of issues; let i = index">
  <app-issue-detail
    [rownum]="i"
    [title]="issue.title"
    [desc]="issue.desc"
    (onDelete)="onDelete(i)">
  </app-issue-detail>
</div>
```

issue-list.component.ts ではIssueServiceからデータを取得し、データを削除する部分を記載しています。

```
import { Component, OnInit } from'@angular/core';

import { Issue } from'../issue';
import { IssueService } from'../issue.service';

@Component({
  selector: 'app-issue-list',
  templateUrl: './issue-list.component.html',
  styleUrls: ['./issue-list.component.css']
})
export class IssueListComponent implements OnInit {

  issues: Issue[];

  constructor (
    private issueService: IssueService
  ) {}

  public ngOnInit () {
    this.issues = this.issueService.list;
  }

  public onDelete(index: number): void {
    this.issueService.delete(index);
  }

}
```

### issue-update.component

今回はこれに加え更新する画面も作成します。`issue-update.component.html`は

```
import { Component, OnInit } from '@angular/core';
import { NgForm } from '@angular/forms';
import { Router, ActivatedRoute, Params } from '@angular/router';

import 'rxjs/add/operator/switchMap';

import { IssueService } from '../issue.service';
import { Issue } from '../issue';
```

`issue-update.component.ts`は

```
import { Component, OnInit } from '@angular/core';
import { NgForm } from '@angular/forms';
import { Router, ActivatedRoute, Params } from '@angular/router';

import 'rxjs/add/operator/switchMap';

import { IssueService } from '../issue.service';
import { Issue } from '../issue';

@Component({
  selector: 'app-issue-update',
  templateUrl: './issue-update.component.html',
  styleUrls: ['./issue-update.component.css']
})
export class IssueUpdateComponent implements OnInit {

  id: number;

  title: string;

  desc: string;

  constructor(
    private router: Router,
    private route: ActivatedRoute,
    private issueService: IssueService
  ) {
  }

  ngOnInit() {
    this.route.params
      .switchMap((params: Params) => {
        this.id = +params['id'];
        return this.issueService.getIssue(this.id);
      })
      .subscribe(issue => {
        this.title = issue.title;
        this.desc = issue.desc;
      });
  }

  public onSubmit(form: NgForm): void {

    const issue = {
      title: form.value.title,
      desc: form.value.desc
    };

    this.issueService.update(form.value.id, issue);

    this.gotoIssue();
  }

  private gotoIssue() {
    this.router.navigate(['./pages/issue']);
  }

}
```

## issue.module

issue.module.ts も確認します。

```
import { NgModule } from '@angular/core';
import { FormsModule } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { IssueComponent } from './issue.component';

import { IssueService } from './issue.service';
import { IssueDetailComponent } from './issue-detail/issue-detail.component';
import { IssueInputComponent } from './issue-input/issue-input.component';
import { IssueListComponent } from './issue-list/issue-list.component';
import { IssueUpdateComponent } from './issue-list/issue-list.component';

@NgModule({
  imports: [
    CommonModule,
    FormsModule
  ],
  declarations: [
    IssueComponent,
    IssueDetailComponent,
    IssueInputComponent,
    IssueListComponent
  ],
  providers: [
    IssueService
  ]
})
export class IssueModule {
```

これでコンポーネント分割が完了しました。

